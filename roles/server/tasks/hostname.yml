---

- name:         Check current hostname
  command:      cat /etc/hostname
  register:     current_hostname
  changed_when: current_hostname.stdout != server_hostname

- name:    Set the hostname in /etc/hostname
  command: echo "{{ server_hostname }}" > /etc/hostname
  when:    current_hostname.stdout != server_hostname

- name:    Set the hostname
  command: hostname "{{ server_hostname }}"
  when:    current_hostname.stdout != server_hostname

- name:       Update /etc/hosts
  lineinfile: dest=/etc/hosts regexp="^127\.0\.0\.1" line="127.0.0.1 localhost {{ server_hostname }}"
